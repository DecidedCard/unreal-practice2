# Unreal Practice2

## 1강 언리얼 엔진 게임 제작 기초

### 게임 콘텐츠의 구조

- 게임 제작을 위해 언리얼 엔진은 자체적으로 설계한 프레임웍을 제공함.
- 이를 게임플레이 프레임웍이라고 부름.
- 언리얼 게임 프레임웍의 각 구성 요소를 파악하고, 이를 확장하면서 게임을 제작하는 것을 권장

### 월드

- 게임 콘텐츠를 담기 위해 제공되는 가상의 공간
- 월드는 시간, 트랜스폼, 틱을 서비스로 제공한다.
- 월드 세팅이라는 콘텐츠 제작을 위한 기본 환경 설정을 제공한다.
- 월드의 기본 단위는 액터로 정의되며, 액터 클래스틑 언제나 접두사 A를 사용한다.

### 게임모드

- 게임 규칙을 지정하고 게임을 판정하는 최고 관리자 액터, 형태가 없다.
- 언리얼 엔진에서 하나의 게임에는 반드시 하나의 게임 모드만 존재한다.
- 게임 모드에서 입장할 사용자의 규격을 지정할 수 있음.
- 멀티플레이어 게임에서 판정을 처리하는 절대적 권위의 심판

### 기믹

- 게임 진행을 위한 이벤트를 발생시키는 사물 액터
- 주로 이벤트 발생을 위한 충돌 영역을 설정하는데, 이를 트리거라고 한다.
- 트리거를 통해 캐릭터와 상호 작용하고, 월드에 액터를 스폰해 콘텐츠를 전개한다.

### 플레이어

- 게임에 입장한 사용자 액터. 형태가 없다.
- 게임 모드의 로그인을 통해 사용자가 게임 월드에 입장하면 플레이어가 생성된다.
- 싱글 플레이 게임에는 0번 플레이어가 설정된다.
- 사용자와의 최종 커뮤니케이션을 담당한다.

### 폰

- 무형의 액터인 플레이어가 빙의해 조종하는 액터
- 길찾기를 사용할 수 있으며, 기믹 및 다른 폰과 상호작용한다.
- 폰 중에서 인간형 폰을 별도로 캐릭터라고 지칭한다.

### 정리

- 게임 콘텐츠 구조의 이해
- 게임 프레임웍의 구성 요서 살펴보기
- 단순한 게임 구조에서 출발해 점점 복잡한 게임으로 확장하는 제작 과정을 이해
- C++ 프로젝트 구성을 위한 기본 설정
- 게임 구성 요소를 폴더별로 분류하고, 헤더 참조를 최소화하는 규칙 수립

## 2강 캐릭터와 입력 시스템

### 액터의 구조

- 월드에 속한 콘텐츠의 기본 단위를 액터라고 함.
- 액터는 트랜스폼을 가지며, 월드로부터 틱과 시간 서비스를 제공받는다.
- 사실 액터는 논리적 개념일 뿐 컴포넌트를 감싸는 포장 박스에 불과함.
- 실질적인 구현은 컴포넌트가 진행하고 액터는 다수의 컴포넌트를 소유하고 있음.
- 다수의 컴포넌트를 대표하는 컴포넌트를 루트 컴포넌트라고 한다.
- 액터는 루트 컴포넌트를 가져야 하며, 루트 컴포넌트의 트랜스폼은 액터의 트랜스폼을 의미한다.

### C++ 액터에서 컴포넌트의 생성

- 컴포넌트는 언리얼 오브젝트이브로 UPROPERTY를 설정하고 TObjectPtr로 포인터를 선언한다.
  - 언리얼 5버전부터 헤더에 언리얼 오브젝트를 선언할 때 일반 포이터에서 TObjectPtr로 변경
- 컴포넌트 등록
  - CDO에서 생성한 컴포넌트는 자동으로 월드에 등록된다.
  - NewObject로 생성한 컴포넌트는 반드시 등록절차를 거쳐야 한다.
  - 등록된 컴포넌트는 월드의 기능을 사용할 수 있으며, 물리와 렌더링 처리에 합류한다.
- 컴포넌트의 확장 설계
  - 에디터 편집 및 블루프린트로의 승계를 위한 설정
  - UPROPERTY에 지정자를 설정할 수 있다.
- 컴포넌트 지정자
  - Visible / Edit: 크게 객체타입과 값타입으로 사용
  - Anywhere / DefaultsOnly / InstanceOnly: 에디터에서 편집 가능 영역
  - BlueprintReadOnly / BlueprintReadWrite: 블루프린트로 확장시 읽기 혹은 읽기쓰기 권한을 부여
  - Category: 에디터 편집 영역에서의 카테고리 지정

### 폰의 기능과 설계

- 폰은 액터를 상속받은 특별한 액터이며, 플레이어가 빙의해 입출력을 처리하도록 설계되어 있음.
- 폰은 길찾기를 사용할 수 있으며, 일반적으로 세 가지 주요 컴포넌트로 구성된다.
  - 기믹과 상호작용을 담당하는 충돌 컴포넌트 (루트컴포넌트)
  - 시각적인 비주얼을 담당하는 메시 컴포넌트
  - 움직임을 담당하는 컴포넌트
- 컴포넌트 중에서 트랜스폼 없이 기능만 제공하는 컴포넌트를 액터컴포넌트라고 한다.

### 캐릭터의 기본 구조

- 캐릭터는 인간형 폰을 구성하도록 언리얼이 제공하는 전문 폰 클래스를 의미한다.
- 캐릭터는 세 가지 주요 컴포넌트로 구성되어 있다.
  - 기믹과 상호작용을 담당하는 캡슐 컴포넌트 (루트컴포넌트)
  - 애니메이션 캐릭터를 표현하는 스켈레탈 메시 컴포넌트
  - 캐릭터의 움직임을 담당하는 캐릭터 무브먼트(CharacterMovement) 컴포넌트

### 입력 시스템의 동작 방식

- 플레이어의 입력은 컨트롤러를 통해 폰으로 전달됨.
- 입력을 컨트롤러가 처리할 수도, 폰이 처리할 수도 있는데, 일반적으로는 폰이 처리하도록 설정
  - 예) GTA같은 다양한 사물에 빙의하는 게임의 경우 폰이 유리

### 향상된 입력시스템

- 기존 입력시스템을 대체하고 언리얼 5.1부터 새롭게 도입
- 사용자의 입력 설정 변경에 유연하게 대처할 수 있도록 구조를 재수립
- 사용자 입력 처리를 네 단계로 세분화하고 각 설정을 독립적인 애셋으로 대체

### 향상된 입력시스템 동작 구성

- 사용자의 입력 데이터를 최종 함수에 매핑하는 과정을 체계적으로 구성
- 플랫폼에 따른 다양한 입력 장치의 설정
  - 예) 게임패드용 입력 매핑 컨텍스트, 키보드용 입력 매핑 컨텍스트
- 입력 값의 변경
  - 예) AD/WS 입력값을 Y축과 X축으로 변경, 값 반전의 처리
- 이벤트 발생 조건의 상세 설정
  - 예) 일반 버튼인가? 축 이동인가? 일정 이상 눌러야 하는가?

### 정리

- 액터와 컴포넌트 개념의 이해
- 컴포넌트 속성에 지정자를 추가해 블루프린트로 확장하는 방법의 이해
- 폰과 캐릭터를 구성하는 3대 구성 요소
- 언리얼 5.1에서 추가된 향상된 입력 시스템의 사용 방법

## 3강 캐릭터 컨트롤

### 캐릭터 컨트롤

- 일반적으로 컨트롤러와 폰, 카메라, 스프링암, 캐릭터 무브먼트의 다섯 가지 요소를 사용해 설정.
- 컨트롤러: 입력자의 의지을 지정할 때 사용. ControlRotation 속성
- 폰: 폰의 트랜스폼을 지정
- 카메라 : 화면 구도를 설정하기 사용. 주로 1인칭 시점에서 사용
- 스프링 암 : 화면 구도를 설정하기 위해 사용. 주로 3인칭 시점에서 사용
- 캐릭터 무브먼트: 캐릭터의 이동과 회전을 조정하는 용도로 사용

### 폰의 이동 함수

- Look 함수 : 마우스 입력으로부터 컨트롤러의 컨트롤 회전을 설정
- Move 함수 : 컨트롤러의 컨트롤 회전으로부터 Yaw 값을 참고해 이동 방향을 설정
- 콘솔 커맨드 창으로부터 Control Rotation 값을 확인할 수 있음.

### 폰의 컨트롤 옵션

- Use Controller Rotation (Yaw/Roll/Pitch)
- 컨트롤러에 지정된 Control Rotation 값에 폰의 Rotation을 맞출 것인가?
- 이 옵션을 켜면 폰의 회전은 컨트롤러의 Control Rotation과 동기화됨.

### 스프링암의 컨트롤 옵션

- Use Pawn Control Rotation
- Inherit (Yaw/Roll/Pitch)
- Do Collision Test
- 폰의 컨트롤 회전( 컨트롤러의 Control Rotation )을 사용할 것인가?
- 부모 컴포넌트 ( 주로 RootComponent ) 의 회전을 그대로 따를 것인가?
- 스프링암 중간에 장애물이 있으면 앞으로 당길 것인가? ( Camera라는 트레이스 채널을 사용 )
- 3인칭 시점 설정에 주로 사용

### 카메라의 컨트롤 옵션

- Use Pawn Control Rotation
- 폰의 컨트롤 회전 ( 컨트롤러의 Control Rotation )을 사용할 것인가?
- 스프링암에 달려 있다면 스프링암의 회전과 함께 고려
- 1인칭 카메라 회전에 주로 사용

### 캐릭터 무브먼트의 이동 옵션

- Movement Mode : None, Walking, Falling
- 땅 (Ground)위에 있으면 Walking 모드
- 땅 위에 없으면 Falling 모드
- 이동 기능을 끄고 싶으면 None 모드
- 이동 모드에서의 이동 수치 : MaxWalkSpeed
- 폴링 모드에서의 점프 수치 : JumpZVelocity

### 캐릭터 무브먼트의 회전 옵션

- Rotation Rate : 회전 속도의 지정
- Use Controller Desired Rotation : 컨트롤 회전을 목표 회전으로 삼고 지정한 속도로 돌리기
- Orient Rotation To Movement : 캐릭터 이동 방향에 회전을 일치시키기
- 폰의 회전 옵션과 충돌이 나지 않도록 주의

### 데이터 애셋

- UDataAsset을 상속받은 언리얼 오브젝트 클래스
- 에디터에서 애셋 형태로 편리하게 데이터를 관리할 수 있음.
- 캐릭터 컨트롤에 관련된 주요 옵션을 모아 애셋으로 관리

### 데이터 애셋의 관리

- 두 가지의 컨트롤 모드를 제공
  - 현재 구현된 컨트롤 모드 : 3인칭 솔더뷰
  - 추가로 구현할 컨트롤 모드 : 3인칭 쿼터뷰
- 입력키 V를 통해 컨트롤 설정을 변경
- ENUM을 통해 두 개의 컨트롤 데이터를 관리

### 데이터 애셋의 구성과 적용

- 각 섹션별로 데이터를 저장
  - Pawn 카테고리
  - 캐릭터 무브먼트 카테고리
  - 입력 카테고리
  - 스프링암 카테고리
- Pawn과 캐릭터무브먼트 데이터는 CharacterBase에서 설정
- 입력과 스프링암 데이터는 CharacterPlayer에서 설정

### 정리

- 컨트롤러에 설정된 ControlRotation 속성의 이해
- 캐틱터의 움직임과 회전을 설정하는 다양한 구성 요소와 설정 값의 이해
- 입력 매핑 콘텍스트를 활용한 뷰의 변환 구현
